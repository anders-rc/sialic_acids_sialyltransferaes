<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Ácidos Siálicos</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .tabs { display: flex; gap: 20px; cursor: pointer; margin-bottom: 20px; }
        .tab { padding: 10px 15px; background: #ddd; border-radius: 5px; }
        .tab.active { background: #aaa; }
        .content { display: none; }
        .content.active { display: block; }

        table { border-collapse: collapse; width: 100%; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 8px; }
        th { background: #eee; }

        img { max-width: 100%; height: auto; margin-top: 20px; }
    </style>
</head>
<body>

<h1>Ácidos Siálicos</h1>

<div class="tabs">
    <div class="tab active" onclick="openTab('menu', this)">Menu</div>
    <div class="tab" onclick="openTab('genes', this)">Genes</div>
    <div class="tab" onclick="openTab('blat', this)">BLAT</div>
    <div class="tab" onclick="openTab('blastp', this)">BLASTp</div>
    <div class="tab" onclick="openTab('blatDiagram', this)">BLAT Diagram</div>
</div>

<div id="menu" class="content active">
    <h2>Ácidos Siálicos</h2>

    <p>Os ácidos siálicos (Sia)...</p>

    <h2>Biossíntese</h2>
    <img src="Sialilacao_process.png" alt="Figura da biossíntese">
</div>

<div id="genes" class="content">
    <h2>Genes</h2>

    <table id="genesTable">
        <thead>
            <tr>
                <th>ID NCBI</th>
                <th>Símbolo</th>
                <th>Nome</th>
                <th>Proteínas</th>
                <th>Transcritos</th>
                <th>Tipo</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<div id="blat" class="content">

    <table id="blatTable">
        <thead>
            <tr>
                <th>ID NCBI</th>
                <th>Query</th>
                <th>Score</th>
                <th>Identity</th>
                <th>Chrom</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
    
</div>

<div id="blastp" class="content">
    <h2>Resultados BLASTp</h2>

    <table id="blastpTable">
        <thead>
            <tr>
                <th>ID NCBI</th>
                <th>Descrição</th>
                <th>Max Score</th>
                <th>E-value</th>
                <th>% Identidade</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<div id="blatDiagram" class="content">
    <h2>BLAT Diagram</h2>
    <img src="Resultados_Blat.png" alt="BLAT Diagram">
</div>

    
<script>
// ---------------- TABS ---------------- //
function openTab(tab, element) {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));

    element.classList.add('active');
    document.getElementById(tab).classList.add('active');

    // Carregar ao abrir
    if (tab === "genes") loadGenes();
    if (tab === "blat") loadBLAT();
    if (tab === "blastp") loadBLASTp();
}

// ---------------- SUPABASE ---------------- //
const supabaseUrl = "https://inidrupdvxrzphlulgxd.supabase.co";
const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImluaWRydXBkdnhyenBobHVsZ3hkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI2Mzc2MDYsImV4cCI6MjA2ODIxMzYwNn0.NiZQsRtjGOblsaaqFQ7Oc-ffXlnNOvizyXeNX_BrPbU";

const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

// ---------------- GENES ---------------- //
async function loadGenes() {
    // A tabela "Genes" é a segunda aba. Se você quisesse carregar a tabela
    // na primeira aba ("Menu"), você teria que mudar o 'if (tab === "genes")'
    // na função openTab, ou chamar loadGenes() ao carregar a página
    // se quisesse que ela estivesse visível por padrão.
    
    // Como a tabela "Genes" está na sua própria aba, a chamada aqui está correta,
    // garantindo que os dados sejam buscados ao clicar na aba 'Genes'.
    // Para que os dados sejam exibidos *assim que a página carrega* (e a aba
    // "Genes" é a ativa), vamos fazer a chamada no final do script.
    
    const { data, error } = await supabaseClient
        .from('"Genes"')
        .select("*");

    if (error) { console.error(error); return; }

    const tbody = document.querySelector("#genesTable tbody");
    tbody.innerHTML = "";

    data.forEach(row => {
        // Certifique-se de que o nome das colunas corresponde ao seu esquema
        // do Supabase. Use o operador de coalescência nula (??) para
        // evitar "undefined" se o campo puder ser nulo.
        tbody.innerHTML += `
            <tr>
                <td>${row.id_ncbi}</td>
                <td>${row.symbol}</td>
                <td>${row.gene_name ?? ""}</td>
                <td>${row.proteins ?? ""}</td>
                <td>${row.transcripts ?? ""}</td>
                <td>${row.gene_type ?? ""}</td>
            </tr>
        `;
    });
}

// ---------------- BLAT ---------------- //
async function loadBLAT() {
    const { data, error } = await supabaseClient
        .from('"BLAT"')
        .select("*");

    if (error) { console.error(error); return; }

    const tbody = document.querySelector("#blatTable tbody");
    tbody.innerHTML = "";

    data.forEach(row => {
        tbody.innerHTML += `
            <tr>
                <td>${row.id_ncbi}</td>
                <td>${row.query}</td>
                <td>${row.score}</td>
                <td>${row.identity}</td>
                <td>${row.chrom}</td>
            </tr>
        `;
    });
}

// ---------------- BLASTp ---------------- //
async function loadBLASTp() {
    const { data, error } = await supabaseClient
        .from('"BLASTp"')
        .select("*");

    if (error) { console.error(error); return; }

    const tbody = document.querySelector("#blastpTable tbody");
    tbody.innerHTML = "";

    data.forEach(row => {
        tbody.innerHTML += `
            <tr>
                <td>${row.id_ncbi}</td>
                <td>${row.description ?? ""}</td>
                <td>${row.max_score}</td>
                <td>${row.e_value}</td>
                <td>${row.per_ident}</td>
            </tr>
        `;
    });
}

// Carrega a tabela GENES (ou a tabela da aba ativa que você quiser)
// assim que o script é carregado/executado.
// NOTA: A aba 'Menu' é a ativa por padrão, mas a 'Genes' é a primeira a
// exibir uma tabela do BD. Se você quer que a 'Genes' carregue por padrão:
// 1. Torne a aba 'Genes' a 'active' no HTML.
// 2. Chame loadGenes() aqui.
// Como o código original tem 'Menu' ativo, não vamos chamar nenhuma função aqui.
// Se você quiser que a aba 'Genes' seja a padrão:
// 1. Mude a classe 'active' para a div 'genes'.
// 2. Mude a classe 'active' para o botão 'Genes'.
// 3. Chame loadGenes(); aqui.
//
// Para o seu propósito atual de **corrigir** o código, a lógica de carregamento
// condicional dentro de `openTab` está correta e só precisava ser **revisada**
// quanto aos nomes das colunas (já foram revisados acima).

// Se você quisesse que a tabela 'Genes' fosse a *primeira* a ser exibida,
// a correção seria nas classes `active` do HTML e na chamada abaixo:
// window.onload = loadGenes; // Ou simplesmente loadGenes();

</script>

</body>
</html>
